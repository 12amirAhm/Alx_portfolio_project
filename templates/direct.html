
{% extends 'base.html' %}
{% load static %}
{% block content %}

{% load humanize %}

<main style="background-color: #333333;" >
	<style>
		

		@media (min-width: 1751px) {
              .mobile {
                display: none;
               
              }
            }
    



.chat-messages {
    display: flex;
    flex-direction: column;
    max-height: 800px;
    overflow-y: scroll
}

.chat-message-left,
.chat-message-right {
    display: flex;
    flex-shrink: 0
}

.chat-message-left {
    margin-right: auto
}

.chat-message-right {
    flex-direction: row-reverse;
    margin-left: auto
}
.py-3 {
    padding-top: 1rem!important;
    padding-bottom: 1rem!important;
}
.px-4 {
    padding-right: 1.5rem!important;
    padding-left: 1.5rem!important;
}
.flex-grow-0 {
    flex-grow: 0!important;
}
.border-top {
    border-top: 1px solid #2682df!important;
}

.buttonl {
        background-color:white; color: black; padding: 5px; 
        border-radius: 10px;
    }
    
    .buttonl:hover {background-color: rgb(214, 214, 214) ; color: #000;}
    
    .buttonl:active {
      background-color: gray;
      box-shadow: 0 5px #666;
      transform: translateY(4px);
      color: white;
    }
     
	.btn1 {
    padding: 10px 20px;
    margin: 5px;
    background-color: black;
    color: #fff;
    border: none;    
    outline: none;
    border-radius: 5px;
}

	</style>
	<script>
let btnPrimary = document.querySelector('#primary');

btnPrimary.addEventListener('click', () => btnPrimary.style.backgroundColor = '#337ab7')

	</script>
	

    <div style="background-color: #333333;" class="container p-0">

		

		<div  style="background-color: #333333 ; margin-top: 50px;" class="card">
			<div class="row g-0">
				<div class="col-12 col-lg-12 col-xl-3 border-right chat-messages" >

					<!-- <div  style="margin-top: 10px;" class="px-4 d-none d-md-block">
						<div class="d-flex align-items-center">
							<div class="flex-grow-1">
								<a href="{% url 'usersearch' %}" style="margin-bottom: 50px; font-weight: 700; font-size: 15px; margin: 5px; background-color: rgb(0, 157, 255); font-weight: 600; color: black; padding: 5px; border-radius: 20px;">Start New Message</a>
							</div>
						</div>
					</div> -->
					<div style="margin: 20px;" class="mobile">
						<a href="{% url 'usersearch' %}" style=" padding: 7px; padding-left: 10px; border-radius: 5px; background-color: rgb(0, 157, 255); color: black; font-size: 18; align-content: center; font-weight: 600; margin-bottom: 5px;"> Start Chat</a>
					<!-- <div>
						<b style="color: red; font-size: 13px; margin-left: 50px; font-weight: 600;">Scroll Down For the Latest</b>
						<i style="color: red; font-size: 23px; margin-left: 5px;" class="fa-solid fa-arrow-down"></i>
						
					</div> -->
					</div>
							
					
					{% for message in messages %}
					
					<a class="buttonl"  href="{% url 'directs' message.user.username %}" style="margin-top: 10px; padding: 5px;" class="list-group-item list-group-item-action border-0 {% if active_direct == message.user.username %}active{% endif %}" >
						<div class="badge bg-success float-right"></div>
						<div class="d-flex align-items-start pb-2">
							
							{% if message.user.profile.picture %}
							<img style="width: 60px; height: 60px; border-radius: 50px; " src="{{ message.user.profile.picture.url }}" alt="Placeholder image">
						  {% else %}
						  <img style="width: 60px; height: 60px; border-radius: 50px;" src="{% static '\images\default_profile.png' %}" />
						  {% endif %}


						  <div class="flex-grow-1 ml-6">

						  {% if message.user.profile.first_name %}
						  <div style="display: flex; align-items: center;">
							<b style="color: black;">{{ message.user.profile.first_name }}</b>
							<div>
								{% if message.user.profile.golden_checker %} 
								<i style="font-size: 20px; color: goldenrod;" class="bi bi-patch-check-fill "></i>
								{% else %}
								<p> </p>
								{% endif %}
				
							</div>
							<div>
							{% if message.user.profile.job_checker %}
							<i style="font-size: 20px; color: black" class="fa-solid fa-user-tie"></i> 
							{% else %}
							<p> </p>
							{% endif %}
						  </div>
						  <div>
							{% if message.user.profile.blue_checker %}
							<i style="font-size: 20px; color: rgb(0, 157, 255);" class="bi bi-patch-check-fill "></i> 
							{% else %}
							<p> </p>
							{% endif %}
						 </div>

						  </div>
						  
						
						  {% else %}
						  <p>

						  </p>
						  {% endif %}
							
							
							
							
									<div style="color: black;" class="small"> @{{message.user.username}}</div>
								
								
							</div>

              <div style="align-items: center; margin-right: 10px; margin-top: 5px;" class="content">
                {% if message.unread %}
                <div style="font-weight: bold; color: red;">
                  <span>New</span> {{ message.unread }}
                </div>
                {% endif %}        
              </div>
						</div>
					</a>
					{% endfor %}

					<hr class="d-block d-lg-none mt-1 mb-0">
				</div>
				<div class="col-12 col-lg-7 col-xl-9">
					<div class="py-2 px-4 border-bottom d-none d-lg-block">
						<div class="d-flex align-items-center py-1">
							<!-- <div class="position-relative">
								<img src="https://bootdey.com/img/Content/avatar/avatar3.png" class="rounded-circle mr-1" alt="Sharon Lessman" width="40" height="40">
							</div>
							<div class="flex-grow-1 pl-3">
								<strong>Sharon Lessman</strong>
								<div class="text-muted small"><em>Typing...</em></div>
							</div> -->
							<div>
								<button class="btn btn-primary btn-lg mr-1 px-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-phone feather-lg"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg></button>
								<button class="btn btn-info btn-lg mr-1 px-3 d-none d-md-inline-block"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-video feather-lg"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg></button>
								<button class="btn btn-light border btn-lg px-3"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal feather-lg"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></button>
							</div>
							
							
							

						</div>
						
					</div>
  
					<div class="position-relative">
						<div>
							<b style="color: rgb(255, 98, 98); font-size: 13px; margin-left: 50px;">Scroll Down For the Latest</b>
							<i style="color: rgb(255, 98, 98); font-size: 23px; margin-left: 5px;" class="fa-solid fa-arrow-down"></i>
							
						</div>
						<div class="chat-messages p-4">

							{% for direct in directs %}
										{% if direct.sender == request.user %}
											<div style="display: flex; flex-direction: column; " class="chat-message-right pb-2">
												
								 					
													<span style="color: white; ">	@{{direct.sender.username}}</span>
												<div  style=" color: black; background-color: lightgrey; align-items: center; display: flex; padding: 5px; border-radius: 10px; font-size: 16px;" class="flex-shrink-1 bg-light rounded py-2 px-3 ml-3">
													<!-- <div class="font-weight-bold mb-1">Sharon Lessman</div> -->
													{{direct.body}}
												</div>
                                             <div class="text-muted small text-nowrap mt-2" style= " float: right; font-size:10px; color: white;"><p style="font-size:12px; color: white;">{{direct.date|naturaltime }}</p></div>

												
											</div>
										{% else %}
											<div style="display: flex; flex-direction: column;" class="chat-message-left pb-2">
                                            <span style="color: white; font-size: 19px;">	@{{direct.recipient.username}}</span>
											<div   style=" color: black; background-color: rgb(0, 157, 255); align-items: center; display: flex; padding: 5px; border-radius: 10px; font-size: 16px;">
													<!-- <div class="font-weight-bold mb-1">Sharon Lessman</div> -->
													{{direct.body}}
												</div>

                        <div class="text-muted small text-nowrap mt-2" style="font-size:10px; color: rgba(0, 0, 0, 0);"><p style="font-size:12px; color: white">{{direct.date|naturaltime }}</p></div>
											</div>
										{% endif %}
									{% endfor %}
							

						</div>
					</div>

					
					
					<div class="flex-grow-0 py-3 px-4 border-top">
						<form method="POST" action="{% url 'send_direct' %}">
							{% csrf_token %}
							<div class="input-group">
								<input type="hidden" name="to_user" value="{{ active_direct }}">
								{% if directs %}

								
								<input style="font-size: 16px;" name="body" type="text" class="form-control" placeholder="Type your message">
								<button style="font-size: 16px; background-color: rgb(0, 157, 255);" class="btn btn-primary" type="submit">Send</button>
								{% else %}
								<p>
									<span>Start New Message and talk to peoples</span>
								</p>
								
								{% endif %}
					  
						
							</div>
						</form>
						
					</div>
					
						
						
				</div>
			</div>
		</div>
	</div>
</main>

{% endblock content %}